using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GameConsoles1
{
    internal class Program
    {
        static void Main()
        {
          bool isWork = true;
          Exchange exchange = new Exchange();
          Player player = new Player();
          Salesman salesman = new Salesman();
          salesman.AddProducts();

          while (isWork)
          {
              salesman.DisplayProducts();
              Console.WriteLine();
              player.DisplayBuyProducts();
              exchange.ExcangeProduct(player, salesman);
              Console.Clear();
          }

        }

        class Product
        {
           private static int _Ids;
           private int _id;
           private string _name;
           private int _price;
           
           public int Id => _id;
           public int Price => _price;
           
           
           public Product(string name, int price)
           {
               _id = _Ids++;
               _name = name;
               _price = price;
           }
           
           public void DisplayProduct()
           {
               Console.WriteLine($"{_id} - {_name} - {_price}");
           }
        }

        class Deal
        {
            protected List<Product> _products = new List<Product>();
            protected int _money;

            protected void DispalayInfo()
            {
                for (int i = 0; i < _products.Count; i++)
                {
                    _products[i].DisplayProduct();
                }
            }
        }

        class Exchange
        {
            private int GetId()
            {
                Console.WriteLine("Введите номер товара");
                int.TryParse(Console.ReadLine(),out int useId);
                return useId;
            }
            public void ExcangeProduct(Player player, Salesman salesman)
            {
                Product buyProduct = salesman.GetProduct(GetId());
                if (player.CheckForMoney(buyProduct))
                {
                    player.BuyProduct(buyProduct);
                    salesman.TakeMoney(buyProduct);
                    salesman.Remove(buyProduct);
                }   
            }
        }
        class Salesman : Deal
        {
           

           public Salesman()
           {
                
               _money = 0;
           }

           public void AddProducts()
           {
               _products.Add(new Product("Меч", 100));
               _products.Add(new Product("Лук", 200));
               _products.Add(new Product("Щит", 400));
               _products.Add(new Product("Паприка", 30));
           }

           public void DisplayProducts()
           {
               Console.WriteLine("Деньги продовца " + _money);
               DispalayInfo();
           }

           public Product GetProduct(int userId)
           {

               for (int i = 0; i < _products.Count; i++)
               {
                   if (_products[i].Id == userId)
                   {
                       return _products[i];
                   }
               }
               return null;
           }
           

           public void Remove(Product product)
           {
               _products.Remove(product);
           }

           public void TakeMoney(Product product)
           {
               _money += product.Price;
           }
        }
        

       class Player : Deal
       {
         

         public Player()
         {
           _products = new List<Product>();
           _money = 600;
         }

         public void BuyProduct(Product buyProduct)
         {
             _money -= buyProduct.Price;
             _products.Add(buyProduct);
         }
         public void DisplayBuyProducts()
         {
             Console.WriteLine($"Деньги игрока {_money}");
             DispalayInfo();
         }

         public bool CheckForMoney(Product product)
         {
             if (product !=  null && _money >= product.Price)
             {
               return true;
             }
           return false;
         }
       }
    }
}
